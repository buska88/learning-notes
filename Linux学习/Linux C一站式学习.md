# Linux C一站式学习

## chapter 30 进程

进程间通信方式：

不同进程的用户地址空间不同，每个进程的全局变量对其他进程不可见，所以进程之间的数据交换要通过内核，在内核中开辟缓冲区用于进程之间的数据交换：

https://gitee.com/buska88/reading-notes.git![image-20220518085551583](Linux C一站式学习.assets/image-20220518085551583.png

* 管道：本质上是内核的一个缓冲区，通过pipe创建，分为读端和写段供不同进程读写数据。父子进程通过管道交流的方式见书上

  为什么Linux的管道只能单向通信不能双向通信？Linux内核将其设计为只能单向通信的，而Solaris的管道就可以双向通信。原因就是管道的读指针只有一个，多进程读写会造成混乱。原因见https://www.zhihu.com/question/57509551

  ```
  具体一点则是，申请一个缓冲区，作为pipe()操作中匿名管道文件实体，缓冲区设俩指针，一个读指针，一个写指针，并保证读指针向前移动不能超过写指针，否则唤醒写进程并睡眠，直到读满需要的字节数。同理写指针向前也不能超过读指针，否则唤醒读进程并睡眠，直到写满要求的字节数。pipe()返回的两个文件句柄最后指向的其实是一个inode，只不过一个是read only一个是write only.试想同时两个进程读[或者写，假设只有两个进程]的后果，由于i_count会等于2——如果小于2则说明两个进程同时关闭了写句柄，因此会直接退出读函数。此时俩进程会分别认为对方才是写者而反复醒来，反复监测，然并卵没有数据，于是反复睡眠。如果有多个进程，俩进程同时读[或者写]，会造成数据混乱，因为读指针只有一个，而你不能保证读写的顺序。

  作者：知乎用户
  链接：https://www.zhihu.com/question/57509551/answer/153200357
  来源：知乎
  著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。
  ```
